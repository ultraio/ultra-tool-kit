import{d as I,j as J,r as h,p as R,q as W,k as q,a as m,o as s,b as l,F as b,h as r,w as Y,v as Z,f as o,m as i,e as C,C as D,t as f,i as P,n as S,L as G,l as k,B as Q,D as $,P as X}from"./index-9dadb0c5.js";const ee={class:"flex flex-col gap-4"},te=r("div",{class:"text-3xl font-bold"},"Proposals",-1),ae={key:0},ne=r("span",null,"You are not currently logged in, please log in to view proposals.",-1),oe=[ne],ce={class:"flex flex-row gap-2"},se={class:"flex flex-row gap-2"},ie={key:0},le={class:"flex flex-col gap-4"},re=r("div",null,"Details about what is inside of this proposal.",-1),ue={class:"container"},de={class:"flex flex-col gap-4"},ve=I({__name:"index",props:{state:{},metadata:{}},emits:["transact"],setup(E,{emit:z}){J();const a=E,_=z,y=h([]),p=h(""),x=h(!1),v=h(void 0),g=h([]);async function w(){x.value=!0,y.value=await Q.getProposals(a.state.accountName||""),x.value=!1}const N=async e=>{p.value=e},O=R(()=>!p.value||p.value===""?y.value:y.value.filter(e=>e.name.includes(p.value)||e.proposer.includes(p.value))),A=e=>{for(let t in e){let c=e[t];if(typeof c=="string"){if(c.startsWith("PUB_K1_")&&c.length===57)try{let u=X.from(c);e[t]=u.toLegacyString()}catch{}}else typeof c=="object"&&A(c)}},V=async e=>{v.value=e,g.value=[];for(let t of v.value.readable.actions)t.account==="eosio"&&t.name==="setcode"?g.value.push({contract:t.data.account,isAbi:!1,hash:$.createHash("sha256").update(t.data.code,"hex").digest("hex")}):t.account==="eosio"&&t.name==="setabi"&&g.value.push({contract:t.data.account,isAbi:!0,hash:$.createHash("sha256").update(t.data.abi,"hex").digest("hex")});A(e)},L=e=>{if(e.proposer===a.state.accountName)return!0;let t=new Date(e.readable.expiration+"Z");return!!(e.readable&&e.readable.expiration&&Date.now()>t.getTime())},M=e=>{const t=[{contract:"eosio.msig",action:"approve",authorization:[{actor:a.state.accountName,permission:a.state.accountPerm?a.state.accountPerm:"active"}],data:{proposer:e.proposer,proposal_name:e.name,level:{actor:a.state.accountName,permission:a.state.accountPerm?a.state.accountPerm:"active"}}}];_("transact",t)},T=e=>{const t=[{contract:"eosio.msig",action:"exec",authorization:[{actor:a.state.accountName,permission:a.state.accountPerm?a.state.accountPerm:"active"}],data:{proposer:e.proposer,proposal_name:e.name,executer:a.state.accountName}}];_("transact",t)},U=e=>{const t=[{contract:"eosio.msig",action:"unapprove",authorization:[{actor:a.state.accountName,permission:a.state.accountPerm?a.state.accountPerm:"active"}],data:{proposer:e.proposer,proposal_name:e.name,level:{actor:a.state.accountName,permission:a.state.accountPerm?a.state.accountPerm:"active"}}}];_("transact",t)},H=e=>{const t=[{contract:"eosio.msig",action:"cancel",authorization:[{actor:a.state.accountName,permission:a.state.accountPerm?a.state.accountPerm:"active"}],data:{proposer:e.proposer,proposal_name:e.name,canceler:a.state.accountName}}];_("transact",t)};return W(()=>a.state,(e,t)=>{console.log("Watch props.state function called with args:",t.accountName,e.accountName),e.accountName&&w()},{deep:!0}),q(async()=>{a.state.accountName&&w()}),(e,t)=>{const c=m("Icon"),u=m("Button"),B=m("ActionDetail"),K=m("Code"),j=m("Expand"),F=m("Modal");return s(),l("div",ee,[te,a.state.accountName?(s(),l(b,{key:1},[r("div",ce,[Y(r("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>p.value=n),placeholder:"Search...",class:"flex-grow rounded bg-neutral-950 text-neutral-200 pl-4 border border-neutral-700 focus:outline-none pr-4"},null,512),[[Z,p.value]]),o(u,{disabled:p.value===""},{default:i(()=>[o(c,{icon:"fa-trash",class:"clear-search",onClick:t[1]||(t[1]=n=>N(""))})]),_:1},8,["disabled"])]),(s(!0),l(b,null,C(O.value,n=>(s(),l("div",se,[r("div",{class:D(["flex flex-col items-center justify-center h-12 w-12 bg-neutral-700 rounded",n.approved?["text-green-300"]:["text-red-300"]])},[o(c,{icon:n.approved?"fa-check":"fa-times",class:"clear-search",onClick:t[2]||(t[2]=d=>N(""))},null,8,["icon"])],2),r("div",{class:D(["flex flex-col items-center justify-center w-32 flex-grow bg-neutral-700 rounded select-none",n.approved?["text-green-300"]:["text-red-300"]])},f(n.name),3),o(u,{title:"Review",onOnClick:d=>V(n)},{default:i(()=>[o(c,{icon:"fa-magnifying-glass"})]),_:2},1032,["onOnClick"]),o(u,{title:"Approve",disabled:n.approved,onOnClick:d=>M(n)},{default:i(()=>[o(c,{icon:"fa-check"})]),_:2},1032,["disabled","onOnClick"]),o(u,{title:"Execute",disabled:n.approved===!1,onOnClick:d=>T(n)},{default:i(()=>[o(c,{icon:"fa-paper-plane"})]),_:2},1032,["disabled","onOnClick"]),o(u,{title:"Unapprove",disabled:n.approved===!1,onOnClick:d=>U(n)},{default:i(()=>[o(c,{icon:"fa-ban"})]),_:2},1032,["disabled","onOnClick"]),o(u,{title:"Cancel",disabled:!L(n),onOnClick:d=>H(n)},{default:i(()=>[o(c,{icon:"fa-trash"})]),_:2},1032,["disabled","onOnClick"])]))),256)),O.value.length==0&&!x.value?(s(),l("p",ie,"No proposals found")):P("",!0),x.value?(s(),S(G,{key:1})):P("",!0)],64)):(s(),l("div",ae,oe)),v.value?(s(),S(F,{key:2,title:v.value.name+" Proposal",onClose:t[3]||(t[3]=n=>v.value=void 0)},{default:i(()=>[r("div",le,[re,(s(!0),l(b,null,C(v.value.readable.actions,(n,d)=>(s(),l("div",{key:d},[o(B,null,{contract:i(()=>[k(f(n.account),1)]),action:i(()=>[k(f(n.name),1)]),_:2},1024)]))),128)),r("div",ue,[o(j,{title:"View Proposal JSON"},{default:i(()=>[r("div",de,[(s(!0),l(b,null,C(g.value,(n,d)=>(s(),l("div",{key:d},[o(B,null,{contract:i(()=>[k(f(n.contract)+f(n.isAbi?".abi":".wasm"),1)]),action:i(()=>[k(f(n.hash),1)]),_:2},1024)]))),128)),o(K,{code:JSON.stringify(v.value.readable)},null,8,["code"])])]),_:1})])])]),_:1},8,["title"])):P("",!0)])}}});export{ve as default};
