import{d as J,j as Z,r as h,k as ee,q as ae,a as D,o as c,b,h as t,w as te,v as se,A as le,f as r,m as s,n as q,i as N,l as _,F as ne,t as o,M as oe,S as ie,T as re,P as ue,U as de,B as Q}from"./index-e68b890c.js";import{f as S}from"./formatters-7d8279ee.js";const ce={class:"flex flex-col gap-4"},pe=t("div",{class:"text-3xl font-bold"},"User Uniq Explorer",-1),ve=t("div",null,"Start the search by entering a username",-1),fe={class:"flex flex-col gap-4"},me={class:"flex flex-row gap-4"},he={key:1,class:"flex flex-col justify-center items-center gap-4"},be=t("div",null,"Sorry, there seems to be no results for your search",-1),_e=t("div",{class:"text-2xl font-bold"},"Inventory",-1),ye={class:"flex flex-col gap-4"},ge=t("div",{class:"text-2xl font-bold"},"Factories",-1),xe={class:"bg-neutral-800 p-4 rounded border border-neutral-700"},we=["href"],ke=t("p",null,"No Factories found",-1),Ce=t("br",null,null,-1),Ie={class:"flex flex-col gap-4"},Te=t("div",{class:"text-2xl font-bold"},"Uniqs",-1),De={class:"bg-neutral-800 p-4 rounded border border-neutral-700"},qe=["href"],Oe=["href"],$e=t("p",null,"No Uniqs found",-1),Ue=t("br",null,null,-1),Ne={class:"flex flex-col gap-4"},Fe=t("div",{class:"text-2xl font-bold"},"Uniqs Resale",-1),Ee={class:"bg-neutral-800 p-4 rounded border border-neutral-700"},Pe=["href"],Se=["href"],Le=t("p",null,"No Uniqs found",-1),Be=t("br",null,null,-1),Me={class:"flex flex-col gap-4"},Re=t("div",{class:"text-2xl font-bold"},"Received Offers",-1),Ae={class:"bg-neutral-800 p-4 rounded border border-neutral-700"},ze=["href"],Qe={key:1},Ve=["href"],Ke={key:1},Xe=["href"],je=t("p",null,"No Received Offers found",-1),We=t("br",null,null,-1),Ye={class:"flex flex-col gap-4"},Ge=t("div",{class:"text-2xl font-bold"},"Sent Offers",-1),He={class:"bg-neutral-800 p-4 rounded border border-neutral-700"},Je=["href"],Ze={key:1},ea=["href"],aa={key:1},ta=["href"],sa=t("p",null,"No Sent Offers found",-1),oa=J({__name:"index",props:{state:{},metadata:{}},emits:["transact"],setup(V,{emit:K}){const F=K,O=Z(),y=V,d=h(null),X=h(1),$=h("waiting"),C=h(!1),i=h(!1),E=h(null),p=h({pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:[{text:"Factory ID",value:"id"},{text:"Factory Name",value:"name"}],rows:[]}}),g=h({pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:[{text:"Uniq ID",value:"id",sortable:!0},{text:"Serial Number",value:"serialNumber",sortable:!0},{text:"Uniq Name",value:"name"},{text:"Factory ID",value:"factoryId",sortable:!0},{text:"Factory Name",value:"factory"}],rows:[]}}),x=h({pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:[{text:"Uniq ID",value:"id",sortable:!0},{text:"Factory ID",value:"factoryId",sortable:!0},{text:"Price",value:"price"},{text:"Promoter Basis Points",value:"basisPoints"}],rows:[]}}),v=h({pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:[{text:"Type",value:"type",sortable:!0},{text:"Offer Expiry",value:"expiryDate",sortable:!0},{text:"Uniq Factory ID",value:"uniqFactoryId",sortable:!0},{text:"Uniq ID",value:"uniqId",sortable:!0},{text:"Bidder",value:"buyer"},{text:"Price",value:"price",sortable:!0},{text:"Status",value:"status"},{text:"Action",value:"cancelAction"}],rows:[]}}),f=h({pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:[{text:"Type",value:"type",sortable:!0},{text:"Offer Expiry",value:"expiryDate",sortable:!0},{text:"Uniq Factory ID",value:"uniqFactoryId",sortable:!0},{text:"Uniq ID",value:"uniqId",sortable:!0},{text:"Owner",value:"owner"},{text:"Price",value:"price",sortable:!0},{text:"Status",value:"status"},{text:"Action",value:"cancelAction"}],rows:[]}}),T=h(!1);function j(){v.value={pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:v.value.dataTable.headers,rows:[]}}}function W(){f.value={pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:f.value.dataTable.headers,rows:[]}}}function L(l){d.value=l,X.value++}function B(){p.value={pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:p.value.dataTable.headers,rows:[]}},g.value={pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:g.value.dataTable.headers,rows:[]}},x.value={pagination:{limit:25,skip:0},totalCount:0,data:[],dataTable:{headers:x.value.dataTable.headers,rows:[]}},j(),W()}function Y(){$.value="waiting",B(),L(null)}async function G(){oe(F,O),O.query.id&&(L(O.query.id),P())}async function M(){i.value=!0;const l=await ie(d.value,p.value.pagination.limit,p.value.pagination.skip);p.value.data.push(...l.data),p.value.pagination.skip+=l.data.length,p.value.totalCount=l.totalCount,p.value.dataTable.rows=p.value.data.map(a=>{var u,n;return{id:parseInt(a.id),name:S((n=(u=a.metadata)==null?void 0:u.content)==null?void 0:n.name)}}),i.value=!1}async function U(l){i.value=!0;let a=l?x:g;const u=await re(d.value,null,a.value.pagination.limit,a.value.pagination.skip,l?!0:void 0);a.value.data.push(...u.data),a.value.pagination.skip+=u.data.length,a.value.totalCount=u.totalCount,a.value.dataTable.rows=a.value.data.map(n=>{var m,w,k,e;return l?{id:parseInt(n.id),factoryId:parseInt(n.factory.id),price:`${n.resale.price.amount} ${n.resale.price.currency.code}`,basisPoints:`${n.resale.promoterBasisPoints/100}% (${n.resale.promoterBasisPoints})`}:{id:parseInt(n.id),serialNumber:parseInt(n.serialNumber),name:S((w=(m=n.metadata)==null?void 0:m.content)==null?void 0:w.name),factoryId:parseInt(n.factory.id),factory:S((e=(k=n.factory.metadata)==null?void 0:k.content)==null?void 0:e.name)}}),i.value=!1}async function R(){i.value=!0;try{const l=await ue({owner:d.value,uniqId:void 0},v.value.pagination.limit,v.value.pagination.skip);v.value.data.push(...l.data),v.value.pagination.skip+=l.data.length,v.value.totalCount=l.totalCount,v.value.dataTable.rows=v.value.data.map(a=>{const u=new Date,m=new Date(a.expiryDate)<u?"EXPIRED":"ACTIVE";return{id:a.id,type:a.type,expiryDate:a.expiryDate,uniqFactoryId:a.uniqFactory.id??"-",uniqId:a.uniq.id??"-",buyer:a.buyer,price:parseFloat(a.price.amount),priceUnit:a.price.currency.code,status:m,cancelAction:{type:a.type,uniqId:a.uniq.id,uniqFactoryId:a.uniqFactory.id,offerId:a.id,buyer:a.buyer,owner:d.value,status:m}}})}catch(l){console.error("Error fetching received offers:",l)}finally{i.value=!1}}async function A(){i.value=!0;try{const l=await de(d.value,f.value.pagination.limit,f.value.pagination.skip);f.value.data.push(...l.data),f.value.pagination.skip+=l.data.length,f.value.totalCount=l.totalCount,f.value.dataTable.rows=f.value.data.map(a=>{const u=new Date,m=new Date(a.expiryDate)<u?"EXPIRED":"ACTIVE";return{type:a.type,expiryDate:a.expiryDate,uniqFactoryId:a.uniqFactoryId??"-",uniqId:a.uniqId??"-",owner:a.type=="UNIQ"?a.uniq.owner:a.uniqFactory.owner,price:parseFloat(a.price.amount),priceUnit:a.price.currency.code,status:m,cancelAction:{type:a.type,factoryId:a.uniqFactoryId,uniqId:a.uniqId,offerId:a.id}}})}catch(l){console.error("Error fetching sent offers:",l)}finally{i.value=!1}}async function H(l,a,u,n){let m=[{contract:"eosio.nft.ft",action:l=="UNIQ"?"acptnftofr.a":"acptfctofr.a",authorization:[{actor:y.state.accountName,permission:y.state.accountPerm?y.state.accountPerm:"active"}],data:{owner:a,nft_id:u,offer_id:n,memo:"Accept Offer"}}];F("transact",m)}async function z(l,a,u,n){let m=[{contract:"eosio.nft.ft",action:l=="UNIQ"?"rmnftofr.a":"rmfctofr.a",authorization:[{actor:y.state.accountName,permission:y.state.accountPerm?y.state.accountPerm:"active"}],data:{canceler:y.state.accountName,offer_id:n,memo:"Cancel Offer"}}];m[0].data[l=="UNIQ_FACTORY"?"factory_id":"nft_id"]=l=="UNIQ_FACTORY"?a:u,F("transact",m)}async function P(){d.value=d.value.trim(),window.history.pushState("user","",`${O.path}?env=${Q.environment}&id=${d.value}`),B(),C.value=!0,T.value=d.value===y.state.accountName;try{d.value&&(E.value=await Q.getAccountData(d.value),await M(),await U(!1),await U(!0),await R(),await A()),$.value=E.value?"success":"failure"}catch(l){console.error(`findUniq error: ${l}`),$.value="error"}C.value=!1}return ee(()=>{G()}),ae(()=>y.state,(l,a)=>{T.value=d.value===(l==null?void 0:l.accountName)},{deep:!0}),(l,a)=>{const u=D("Icon"),n=D("Button"),m=D("LoadingSpinner"),w=D("EasyDataTable"),k=D("Expand");return c(),b("div",ce,[pe,ve,t("div",fe,[t("div",me,[te(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),placeholder:"12 Characters Max | Uses: (a-z1-5.)",min:0,type:"string",onKeyup:le(P,["enter"]),class:"flex-grow rounded bg-neutral-950 text-neutral-200 pl-4 border border-neutral-700 focus:outline-none pr-4"},null,544),[[se,d.value]]),r(n,{disabled:d.value==="",onClick:P},{default:s(()=>[C.value?(c(),q(u,{key:1,icon:"fa-spinner",spin:""})):(c(),q(u,{key:0,icon:"fa-solid fa-magnifying-glass"}))]),_:1},8,["disabled"])])]),C.value?(c(),q(m,{key:0})):N("",!0),!C.value&&$.value==="failure"?(c(),b("div",he,[be,r(n,{onClick:Y},{default:s(()=>[_(" Clear Search ")]),_:1})])):N("",!0),!C.value&&E.value?(c(),b(ne,{key:2},[_e,t("div",ye,[ge,r(k,{expanded:!0},{default:s(()=>[t("div",xe,[r(w,{"table-class-name":"datatable-table",headers:p.value.dataTable.headers,items:p.value.dataTable.rows,"multi-sort":"","rows-items":["25","50","100"],"rows-per-page":100,"buttons-pagination":"","theme-color":"rgb(169 132 232 / var(--tw-text-opacity))"},{"item-id":s(({id:e})=>[t("a",{class:"underline",href:`/uniqFactory?id=${e}`,target:"_blank"},o(e),9,we)]),"empty-message":s(()=>[ke]),_:1},8,["headers","items","theme-color"]),r(n,{disabled:p.value.totalCount==p.value.data.length||i.value,onOnClick:M,class:"w-full mt-6"},{default:s(()=>[_(o(i.value?"Loading...":`Load More (${p.value.totalCount-p.value.data.length})`),1)]),_:1},8,["disabled"])])]),_:1})]),Ce,t("div",Ie,[Te,r(k,{expanded:!0},{default:s(()=>[t("div",De,[r(w,{"table-class-name":"datatable-table",headers:g.value.dataTable.headers,items:g.value.dataTable.rows,"multi-sort":"","rows-items":["25","50","100"],"rows-per-page":100,"buttons-pagination":"","theme-color":"rgb(169 132 232 / var(--tw-text-opacity))"},{"item-id":s(({id:e})=>[t("a",{class:"underline",href:`/uniq?id=${e}`,target:"_blank"},o(e),9,qe)]),"item-factoryId":s(({factoryId:e})=>[t("a",{class:"underline",href:`/uniqFactory?id=${e}`,target:"_blank"},o(e),9,Oe)]),"empty-message":s(()=>[$e]),_:1},8,["headers","items","theme-color"]),r(n,{disabled:g.value.totalCount==g.value.data.length||i.value,onOnClick:a[1]||(a[1]=e=>U(!1)),class:"w-full mt-6"},{default:s(()=>[_(o(i.value?"Loading...":`Load More (${g.value.totalCount-g.value.data.length})`),1)]),_:1},8,["disabled"])])]),_:1})]),Ue,t("div",Ne,[Fe,r(k,{expanded:!0},{default:s(()=>[t("div",Ee,[r(w,{"table-class-name":"datatable-table",headers:x.value.dataTable.headers,items:x.value.dataTable.rows,"multi-sort":"","rows-items":["25","50","100"],"rows-per-page":100,"buttons-pagination":"","theme-color":"rgb(169 132 232 / var(--tw-text-opacity))"},{"item-id":s(({id:e})=>[t("a",{class:"underline",href:`/uniq?id=${e}`,target:"_blank"},o(e),9,Pe)]),"item-factoryId":s(({factoryId:e})=>[t("a",{class:"underline",href:`/uniqFactory?id=${e}`,target:"_blank"},o(e),9,Se)]),"empty-message":s(()=>[Le]),_:1},8,["headers","items","theme-color"]),r(n,{disabled:x.value.totalCount==x.value.data.length||i.value,onOnClick:a[2]||(a[2]=e=>U(!0)),class:"w-full mt-6"},{default:s(()=>[_(o(i.value?"Loading...":`Load More (${x.value.totalCount-x.value.data.length})`),1)]),_:1},8,["disabled"])])]),_:1})]),Be,t("div",Me,[Re,r(k,{expanded:!0},{default:s(()=>[t("div",Ae,[r(w,{"table-class-name":"datatable-table",headers:v.value.dataTable.headers,items:v.value.dataTable.rows,"multi-sort":"","rows-items":["25","50","100"],"rows-per-page":100,"buttons-pagination":"","theme-color":"rgb(169 132 232 / var(--tw-text-opacity))"},{"item-uniqFactoryId":s(({uniqFactoryId:e})=>[e!="-"?(c(),b("a",{key:0,class:"underline",href:`/uniqFactory?id=${e}`,target:"_blank"},o(e),9,ze)):(c(),b("span",Qe,o(e),1))]),"item-uniqId":s(({uniqId:e})=>[e!="-"?(c(),b("a",{key:0,class:"underline",href:`/uniq?id=${e}`,target:"_blank"},o(e),9,Ve)):(c(),b("span",Ke,o(e),1))]),"item-buyer":s(({buyer:e})=>[t("a",{class:"underline",href:`/user?id=${e}`,target:"_blank"},o(e),9,Xe)]),"item-price":s(({price:e,priceUnit:I})=>[_(o(e)+" "+o(I),1)]),"item-cancelAction":s(({cancelAction:e})=>[e.status==="ACTIVE"?(c(),q(n,{key:0,size:"sm",disabled:!T.value,onOnClick:I=>H(e.type,e.owner,e.uniqId,e.offerId)},{default:s(()=>[_(" Accept ")]),_:2},1032,["disabled","onOnClick"])):e.status==="EXPIRED"?(c(),q(n,{key:1,size:"sm",disabled:!T.value,onOnClick:I=>z(e.type,e.factoryId,e.uniqId,e.offerId)},{default:s(()=>[_(" Cancel ")]),_:2},1032,["disabled","onOnClick"])):N("",!0)]),"empty-message":s(()=>[je]),_:1},8,["headers","items","theme-color"]),r(n,{disabled:v.value.totalCount==v.value.data.length||i.value,onOnClick:R,class:"w-full mt-6"},{default:s(()=>[_(o(i.value?"Loading...":`Load More (${v.value.totalCount-v.value.data.length})`),1)]),_:1},8,["disabled"])])]),_:1})]),We,t("div",Ye,[Ge,r(k,{expanded:!0},{default:s(()=>[t("div",He,[r(w,{"table-class-name":"datatable-table",headers:f.value.dataTable.headers,items:f.value.dataTable.rows,"multi-sort":"","rows-items":["25","50","100"],"rows-per-page":100,"buttons-pagination":"","theme-color":"rgb(169 132 232 / var(--tw-text-opacity))"},{"item-uniqFactoryId":s(({uniqFactoryId:e})=>[e!="-"?(c(),b("a",{key:0,class:"underline",href:`/uniqFactory?id=${e}`,target:"_blank"},o(e),9,Je)):(c(),b("span",Ze,o(e),1))]),"item-uniqId":s(({uniqId:e})=>[e!="-"?(c(),b("a",{key:0,class:"underline",href:`/uniq?id=${e}`,target:"_blank"},o(e),9,ea)):(c(),b("span",aa,o(e),1))]),"item-owner":s(({owner:e})=>[t("a",{class:"underline",href:`/user?id=${e}`,target:"_blank"},o(e),9,ta)]),"item-price":s(({price:e,priceUnit:I})=>[_(o(e)+" "+o(I),1)]),"item-cancelAction":s(({cancelAction:e})=>[r(n,{size:"sm",disabled:!T.value,onOnClick:I=>z(e.type,e.factoryId,e.uniqId,e.offerId)},{default:s(()=>[_(" Cancel ")]),_:2},1032,["disabled","onOnClick"])]),"empty-message":s(()=>[sa]),_:1},8,["headers","items","theme-color"]),r(n,{disabled:f.value.totalCount==f.value.data.length||i.value,onOnClick:A,class:"w-full mt-6"},{default:s(()=>[_(o(i.value?"Loading...":`Load More (${f.value.totalCount-f.value.data.length})`),1)]),_:1},8,["disabled"])])]),_:1})])],64)):N("",!0)])}}});export{oa as default};
