import{d as te,j as ae,I as oe,r as c,k as le,a as y,o as p,b as g,h as u,w as T,v as B,A as ne,f as m,m as i,F as M,e as P,n as A,t as F,x as se,i as x,l as S,J as ue,B as k}from"./index-30e8b92e.js";const re={class:"flex flex-col gap-4"},ce=u("div",{class:"text-2xl font-bold"},"Search Table",-1),de={class:"flex flex-row gap-2"},ie={class:"flex flex-row gap-4"},pe={class:"flex flex-row gap-2"},fe={class:"flex flex-row gap-2"},be={class:"flex flex-col p-4 border rounded border-neutral-700"},ve={class:"flex flex-row h-12 gap-2"},we=u("p",null,"No Scopes found",-1),me={key:2,class:"flex flex-row gap-2"},_e={key:3,class:"flex flex-col gap-4"},he=u("div",{class:"text-2xl font-bold"},"Results",-1),ge=u("p",null,"No Entries found",-1),xe={class:"flex flex-col"},Se=te({__name:"index",props:{state:{},metadata:{}},emits:["set-endpoint","set-page-state"],setup(ye,{emit:H}){const r=ae(),e=oe({account:"",table:"",scope:"",lower_bound:"",upper_bound:""}),K=c(["eosio","eosio.token","eosio.nft.ft","eosio.group","ultra.avatar","ultra.tools"]),$=c(),f=c(),I=c(),s=c({dataTable:{headers:[{text:"Scope",value:"scope",sortable:!0},{text:"Count",value:"count",sortable:!0},{text:"Action",value:"action"}],rows:[]},notFound:!1}),Q=c("scope"),h=c(),L=c(100),q=c(!0),C=c(!1),b=c(void 0),O=c(),_=c(void 0),U=c(100),E=c(!0);function j(){e.account="",e.table="",e.scope="",e.lower_bound="",e.upper_bound="",_.value=void 0,$.value=null,f.value=null,h.value="",s.value.dataTable.rows=[],q.value=!0,E.value=!0}const z=H;async function G(){ue(z,r),r.query.code&&(e.account=r.query.code,await R()),r.query.scope&&(e.scope=r.query.scope,h.value=r.query.scope),r.query.table&&(e.table=r.query.table),r.query.lower_bound&&(e.lower_bound=r.query.lower_bound),r.query.upper_bound&&(e.upper_bound=r.query.upper_bound),r.query.code&&r.query.scope&&r.query.table&&await N(e.scope)}function W(){let n=[];for(let a of b.value.rows)Object.keys(a).forEach(o=>{n.find(d=>d.value===o)||n.push({text:o,value:o,sortable:!0})});f.value.tables.find(a=>a.name===e.table).key_names.forEach(a=>{n.push({text:a,value:a,sortable:!0})}),_.value={dataTable:{headers:n,rows:[]}}}async function N(n,t=null){E.value=!0,n||(n="0"),e.scope=n;let a=`${r.path}?env=${k.environment}&code=${e.account}&scope=${e.scope}&table=${e.table}`;e.lower_bound&&(a+=`&lower_bound=${e.lower_bound}`),e.upper_bound&&(a+=`&upper_bound=${e.upper_bound}`),window.history.pushState("table","",a),C.value=!0,t&&(e.lower_bound=t);try{t||(O.value="",b.value=void 0);const o=await k.getTableData(e.account,e.scope,e.table,e.lower_bound,e.upper_bound,U.value);b.value?(b.value.next_key=o.next_key,b.value.rows=b.value.rows.concat(o.rows)):b.value=o,O.value=JSON.stringify(b.value),t||W();for(let v of o.rows)Object.keys(v).forEach(w=>{v[w]&&typeof v[w]=="object"&&(v[w]=JSON.stringify(v[w]))});_.value.dataTable.rows=_.value.dataTable.rows.concat(o.rows),(!o.next_key||b.value.rows.length<U.value)&&(E.value=!1);let d=document.getElementById("content");d.scrollTo(0,d.scrollHeight)}catch(o){console.log(o)}C.value=!1}async function X(n){e.account=n,R()}async function R(){let n=e.account;if(j(),e.account=n,!e.account||e.account.length===0)return;$.value=null,f.value=null;let t=await k.getAbi(e.account,!1);t&&($.value=e.account,f.value=t.ABI,f.value.tables.length>0&&(e.table=f.value.tables[0].name))}async function Y(n=-1){let t=0;for(;q.value;){const a=s.value.dataTable.rows.length;if(await J(!1),t+=s.value.dataTable.rows.length-a,n>0&&t>=n)break}}async function D(){s.value.dataTable.rows=[],s.value.notFound=!1,_.value=void 0}async function Z(){h.value="",await J(!0)}async function J(n){if(!f.value.tables.find(d=>d.name===e.table))return;C.value=!0,n&&(s.value.dataTable.rows=[]);let t=n?void 0:I.value,a=await k.getTableByScope(e.account,e.table,L.value,t);for(;a.rows.length===0;)if(t=a.more,a=await k.getTableByScope(e.account,e.table,L.value,t),!a.more||a.more===""){q.value=!1;break}a.rows.length===0&&(s.value.notFound=!0);const o=n?await k.getTableByScope(e.account,e.table,1,e.account):null;o&&o.rows.length===1&&o.rows[0].scope===e.account&&!a.rows.find(d=>d.scope===e.account)&&!s.value.dataTable.rows.find(d=>d.scope===e.account)&&a.rows.push(o.rows[0]),s.value.dataTable.rows=s.value.dataTable.rows.concat(a.rows).filter((d,v,w)=>v===w.findIndex(V=>V.scope===d.scope)),(!a.more||a.more==="")&&(q.value=!1),I.value=a.more,C.value=!1}return le(()=>{G()}),(n,t)=>{const a=y("Icon"),o=y("Button"),d=y("LoadingSpinner"),v=y("Expand"),w=y("EasyDataTable"),V=y("Code");return p(),g("div",re,[ce,u("div",de,[T(u("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.account=l),placeholder:"Contract Account Name",onKeyup:ne(R,["enter"]),onBlur:R,class:"flex-grow rounded bg-neutral-950 text-neutral-200 pl-4 border border-neutral-700 focus:outline-none pr-4"},null,544),[[B,e.account]]),m(o,{onClick:j},{default:i(()=>[m(a,{icon:"fa-trash"})]),_:1})]),u("div",ie,[(p(!0),g(M,null,P(K.value,l=>(p(),A(o,{onClick:ee=>X(l),class:"flex flex-row gap-4 items-center justify-center"},{default:i(()=>[u("span",null,F(l),1)]),_:2},1032,["onClick"]))),256))]),u("div",pe,[T(u("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>e.table=l),onInput:D,placeholder:"Table Name",class:"flex-grow rounded bg-neutral-950 text-neutral-200 pl-4 border border-neutral-700 focus:outline-none pr-4 h-12"},null,544),[[B,e.table]]),f.value?T((p(),g("select",{key:0,class:"flex-row gap-2 bg-neutral-950 rounded focus:outline-none border border-neutral-700 w-full h-12 px-4",single:"","onUpdate:modelValue":t[2]||(t[2]=l=>e.table=l),onChange:D},[(p(!0),g(M,null,P(f.value.tables,l=>(p(),g("option",null,F(l.name),1))),256))],544)),[[se,e.table]]):x("",!0),f.value&&e.table&&s.value.dataTable.rows.length===0&&!s.value.notFound?(p(),A(o,{key:1,onOnClick:Z,class:"w-full"},{default:i(()=>[S(" Search scopes ")]),_:1})):x("",!0)]),C.value?(p(),A(d,{key:0})):x("",!0),u("div",fe,[T(u("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>h.value=l),placeholder:"Scope Name",class:"flex flex-row gap-2 flex-grow rounded bg-neutral-950 text-neutral-200 pl-4 border border-neutral-700 focus:outline-none pr-4"},null,512),[[B,h.value]]),m(o,{onOnClick:t[4]||(t[4]=l=>N(h.value))},{default:i(()=>[S(" Search by scope name ")]),_:1})]),m(v,{title:"Additional Options"},{default:i(()=>[u("div",be,[u("div",ve,[T(u("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>e.lower_bound=l),placeholder:"Lower Bound",class:"flex-grow rounded bg-neutral-950 text-neutral-200 pl-4 border border-neutral-700 focus:outline-none pr-4"},null,512),[[B,e.lower_bound]]),T(u("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>e.upper_bound=l),placeholder:"Upper Bound",class:"flex-grow rounded bg-neutral-950 text-neutral-200 pl-4 border border-neutral-700 focus:outline-none pr-4"},null,512),[[B,e.upper_bound]])])])]),_:1}),s.value.dataTable.rows.length>0||s.value.notFound?(p(),A(w,{key:1,"table-class-name":"datatable-table",headers:s.value.dataTable.headers,items:s.value.dataTable.rows,"multi-sort":"","rows-items":[10,25,50,100],"rows-per-page":10,"search-field":Q.value,"search-value":h.value,"buttons-pagination":"","theme-color":"rgb(169 132 232 / var(--tw-text-opacity))"},{"item-scope":i(({scope:l})=>[S(F(l===""?0:l),1)]),"item-action":i(({scope:l})=>[m(o,{onOnClick:ee=>N(l)},{default:i(()=>[S(" Search ")]),_:2},1032,["onOnClick"])]),"empty-message":i(()=>[we]),_:1},8,["headers","items","search-field","search-value","theme-color"])):x("",!0),s.value.dataTable.rows.length>0?(p(),g("div",me,[m(o,{disabled:!q.value,onOnClick:t[7]||(t[7]=l=>Y(100)),class:"w-full mt-6"},{default:i(()=>[S(" Load 100 scopes ")]),_:1},8,["disabled"])])):x("",!0),_.value?(p(),g("div",_e,[he,m(w,{"table-class-name":"datatable-table",headers:_.value.dataTable.headers,items:_.value.dataTable.rows,"multi-sort":"","rows-items":[10,25,50,100],"rows-per-page":10,"buttons-pagination":"","theme-color":"rgb(169 132 232 / var(--tw-text-opacity))"},{"empty-message":i(()=>[ge]),_:1},8,["headers","items","theme-color"]),E.value?(p(),A(o,{key:0,onClick:t[8]||(t[8]=()=>N(e.scope,b.value.next_key))},{default:i(()=>[S(" Load 100 results ")]),_:1})):x("",!0),m(v,{title:"Raw response"},{default:i(()=>[u("div",xe,[m(V,{code:O.value},null,8,["code"])])]),_:1})])):x("",!0)])}}});export{Se as default};
