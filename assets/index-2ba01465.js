import{d as U,j as F,r as x,p as I,q as J,k as R,a as v,o as c,b as r,F as g,h as l,w as q,v as W,f as o,m as s,e as P,C as y,t as k,i as b,n as O,L as Y,l as D,B as Z}from"./index-e68b890c.js";const G={class:"flex flex-col gap-4"},H=l("div",{class:"text-3xl font-bold"},"Proposals",-1),K={key:0},Q=l("span",null,"You are not currently logged in, please log in to view proposals.",-1),X=[Q],ee={class:"flex flex-row gap-2"},te={class:"flex flex-row gap-2"},ae={key:0},ne={class:"flex flex-col gap-4"},oe=l("div",null,"Details about what is inside of this proposal.",-1),ce={class:"container"},le=U({__name:"index",props:{state:{},metadata:{}},emits:["transact"],setup(A,{emit:B}){F();const e=A,f=B,h=x([]),i=x(""),_=x(!1),p=x(void 0);async function C(){_.value=!0,h.value=await Z.getProposals(e.state.accountName||""),_.value=!1}const N=async t=>{i.value=t},w=I(()=>!i.value||i.value===""?h.value:h.value.filter(t=>t.name.includes(i.value)||t.proposer.includes(i.value))),$=t=>{if(t.proposer===e.state.accountName)return!0;let a=new Date(t.readable.expiration+"Z");return!!(t.readable&&t.readable.expiration&&Date.now()>a.getTime())},S=t=>{const a=[{contract:"eosio.msig",action:"approve",authorization:[{actor:e.state.accountName,permission:e.state.accountPerm?e.state.accountPerm:"active"}],data:{proposer:t.proposer,proposal_name:t.name,level:{actor:e.state.accountName,permission:e.state.accountPerm?e.state.accountPerm:"active"}}}];f("transact",a)},z=t=>{const a=[{contract:"eosio.msig",action:"exec",authorization:[{actor:e.state.accountName,permission:e.state.accountPerm?e.state.accountPerm:"active"}],data:{proposer:t.proposer,proposal_name:t.name,executer:e.state.accountName}}];f("transact",a)},E=t=>{const a=[{contract:"eosio.msig",action:"unapprove",authorization:[{actor:e.state.accountName,permission:e.state.accountPerm?e.state.accountPerm:"active"}],data:{proposer:t.proposer,proposal_name:t.name,level:{actor:e.state.accountName,permission:e.state.accountPerm?e.state.accountPerm:"active"}}}];f("transact",a)},V=t=>{const a=[{contract:"eosio.msig",action:"cancel",authorization:[{actor:e.state.accountName,permission:e.state.accountPerm?e.state.accountPerm:"active"}],data:{proposer:t.proposer,proposal_name:t.name,canceler:e.state.accountName}}];f("transact",a)};return J(()=>e.state,(t,a)=>{console.log("Watch props.state function called with args:",a.accountName,t.accountName),t.accountName&&C()},{deep:!0}),R(async()=>{e.state.accountName&&C()}),(t,a)=>{const u=v("Icon"),m=v("Button"),M=v("ActionDetail"),T=v("Code"),j=v("Expand"),L=v("Modal");return c(),r("div",G,[H,e.state.accountName?(c(),r(g,{key:1},[l("div",ee,[q(l("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>i.value=n),placeholder:"Search...",class:"flex-grow rounded bg-neutral-950 text-neutral-200 pl-4 border border-neutral-700 focus:outline-none pr-4"},null,512),[[W,i.value]]),o(m,{disabled:i.value===""},{default:s(()=>[o(u,{icon:"fa-trash",class:"clear-search",onClick:a[1]||(a[1]=n=>N(""))})]),_:1},8,["disabled"])]),(c(!0),r(g,null,P(w.value,n=>(c(),r("div",te,[l("div",{class:y(["flex flex-col items-center justify-center h-12 w-12 bg-neutral-700 rounded",n.approved?["text-green-300"]:["text-red-300"]])},[o(u,{icon:n.approved?"fa-check":"fa-times",class:"clear-search",onClick:a[2]||(a[2]=d=>N(""))},null,8,["icon"])],2),l("div",{class:y(["flex flex-col items-center justify-center w-32 flex-grow bg-neutral-700 rounded select-none",n.approved?["text-green-300"]:["text-red-300"]])},k(n.name),3),o(m,{title:"Review",onOnClick:d=>p.value=n},{default:s(()=>[o(u,{icon:"fa-magnifying-glass"})]),_:2},1032,["onOnClick"]),o(m,{title:"Approve",disabled:n.approved,onOnClick:d=>S(n)},{default:s(()=>[o(u,{icon:"fa-check"})]),_:2},1032,["disabled","onOnClick"]),o(m,{title:"Execute",disabled:n.approved===!1,onOnClick:d=>z(n)},{default:s(()=>[o(u,{icon:"fa-paper-plane"})]),_:2},1032,["disabled","onOnClick"]),o(m,{title:"Unapprove",disabled:n.approved===!1,onOnClick:d=>E(n)},{default:s(()=>[o(u,{icon:"fa-ban"})]),_:2},1032,["disabled","onOnClick"]),o(m,{title:"Cancel",disabled:!$(n),onOnClick:d=>V(n)},{default:s(()=>[o(u,{icon:"fa-trash"})]),_:2},1032,["disabled","onOnClick"])]))),256)),w.value.length==0&&!_.value?(c(),r("p",ae,"No proposals found")):b("",!0),_.value?(c(),O(Y,{key:1})):b("",!0)],64)):(c(),r("div",K,X)),p.value?(c(),O(L,{key:2,title:p.value.name+" Proposal",onClose:a[3]||(a[3]=n=>p.value=void 0)},{default:s(()=>[l("div",ne,[oe,(c(!0),r(g,null,P(p.value.readable.actions,(n,d)=>(c(),r("div",{key:d},[o(M,null,{contract:s(()=>[D(k(n.account),1)]),action:s(()=>[D(k(n.name),1)]),_:2},1024)]))),128)),l("div",ce,[o(j,{title:"View Proposal JSON"},{default:s(()=>[o(T,{code:JSON.stringify(p.value.readable)},null,8,["code"])]),_:1})])])]),_:1},8,["title"])):b("",!0)])}}});export{le as default};
